{"version":3,"sources":["job/util/performerToID.js"],"names":["getID","async","require","list","cb","idsList","hasFavorites","eachSeries","item","next","findOne","name","then","res","push","_id","favorite","waterfall","callback","tempName","toLowerCase","name_lower","create","type","link","active","err","result"],"mappings":";;;;;QAMgBA,K,GAAAA,K;;AAHhB;;;;AACA;;;;;;AAJA;;;AAKA,IAAIC,QAAQC,QAAQ,OAAR,CAAZ;AACO,SAASF,KAAT,CAAeG,IAAf,EAAqBC,EAArB,EAAyB;AAC5B,QAAIC,UAAU,EAAd;AACA,QAAIC,eAAe,KAAnB;AACA;AACAL,UAAMM,UAAN,CAAiBJ,IAAjB,EACI,UAASK,IAAT,EAAeC,IAAf,EAAqB;AACjB,4BAAUC,OAAV,CAAkB,EAAEC,MAAMH,KAAKG,IAAb,EAAlB,EACKC,IADL,CACU,UAASC,GAAT,EAAc;AAChB,gBAAIA,QAAQ,IAAZ,EAAkB;AACdR,wBAAQS,IAAR,CAAaD,IAAIE,GAAjB;AACA,oBAAIF,IAAIG,QAAR,EAAkB;AACdV,mCAAe,IAAf;AACH;AACDG;AACH,aAND,MAMO;AACHR,sBAAMgB,SAAN,CAAgB,CAAC,UAASC,QAAT,EAAmB;AACxB,wBAAIC,WAAWX,KAAKG,IAAL,CAAUS,WAAV,EAAf;AACA,uCAASV,OAAT,CAAiB,EAAEW,YAAYF,QAAd,EAAjB,EACKP,IADL,CACU,UAASC,GAAT,EAAc;AAChB,4BAAIA,OAAO,IAAX,EAAiB;AACbL,iCAAKQ,QAAL,GAAgB,IAAhB;AACAV,2CAAe,IAAf;AACH,yBAHD,MAGO;AACHE,iCAAKQ,QAAL,GAAgB,KAAhB;AACH;AACDE,iCAAS,IAAT;AACH,qBATL;AAUH,iBAZO,EAaR,UAASA,QAAT,EAAmB;AACf,wCAAUI,MAAV,CAAiB;AACTC,8BAAMf,KAAK,OAAL,CADG;AAETG,8BAAMH,KAAK,MAAL,CAFG;AAGTa,oCAAYb,KAAK,MAAL,EAAaY,WAAb,EAHH;AAITI,8BAAMhB,KAAK,QAAL,CAJG;AAKTQ,kCAAUR,KAAKQ,QALN;AAMTS,gCAAQ;AANC,qBAAjB,EAQKb,IARL,CAQU,UAASC,GAAT,EAAc;AAChB;AACA;AACAR,gCAAQS,IAAR,CAAaD,IAAIE,GAAjB;AACAG,iCAAS,IAAT;AACH,qBAbL;AAcH,iBA5BO,CAAhB,EA8BI,UAASQ,GAAT,EAAcC,MAAd,EAAsB;AAClBlB;AACH,iBAhCL;AAoCH;AACJ,SA9CL;AA+CH,KAjDL,EAkDI,UAASiB,GAAT,EAAc;AACV;AACAtB,WAAG,IAAH,EAAS,EAAEC,SAASA,OAAX,EAAoBC,cAAcA,YAAlC,EAAT;AACH,KArDL;AAuDH","file":"performerToID.js","sourcesContent":["/**\n * Created by Pavel.Kogan on 13/08/2016.\n */\nimport Performer from '../../api/performer/performer.model';\nimport Favorite from '../../api/favorite/favorite.model'\nvar async = require('async');\nexport function getID(list, cb) {\n    let idsList = [];\n    let hasFavorites = false;\n    //console.log(list.length)\n    async.eachSeries(list,\n        function(item, next) {\n            Performer.findOne({ name: item.name })\n                .then(function(res) {\n                    if (res !== null) {\n                        idsList.push(res._id);\n                        if (res.favorite) {\n                            hasFavorites = true;\n                        }\n                        next();\n                    } else {\n                        async.waterfall([function(callback) {\n                                    let tempName = item.name.toLowerCase();\n                                    Favorite.findOne({ name_lower: tempName })\n                                        .then(function(res) {\n                                            if (res != null) {\n                                                item.favorite = true;\n                                                hasFavorites = true;\n                                            } else {\n                                                item.favorite = false;\n                                            }\n                                            callback(null);\n                                        });\n                                },\n                                function(callback) {\n                                    Performer.create({\n                                            type: item[\"@type\"],\n                                            name: item[\"name\"],\n                                            name_lower: item[\"name\"].toLowerCase(),\n                                            link: item[\"sameAs\"],\n                                            favorite: item.favorite,\n                                            active: true\n                                        })\n                                        .then(function(res) {\n                                            //console.log(\"Per Created arr: \", res[0].id);\n                                            //console.log(\"Per Created: \", res.id);\n                                            idsList.push(res._id);\n                                            callback(null);\n                                        })\n                                }\n                            ],\n                            function(err, result) {\n                                next();\n                            })\n\n\n\n                    }\n                })\n        },\n        function(err) {\n            //console.log(idsList)\n            cb(null, { idsList: idsList, hasFavorites: hasFavorites })\n        }\n    )\n}"]}